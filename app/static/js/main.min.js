window.addEventListener("scroll",(function(){const e=document.querySelector(".floating-buttons");e&&(e.style.display="flex")}));const observerOptions={threshold:.1,rootMargin:"0px 0px -50px 0px"},observer=new IntersectionObserver((function(e){e.forEach((e=>{e.isIntersecting&&e.target.classList.add("animate-on-scroll")}))}),observerOptions);if(document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".product-card, .blog-card").forEach((e=>{observer.observe(e)}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".alert.alert-dismissible").forEach((e=>{setTimeout((()=>{new bootstrap.Alert(e).close()}),5e3)}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('form[action*="search"]').forEach((e=>{e.addEventListener("submit",(function(t){const n=e.querySelector('input[name="q"], input[name="search"]');n&&""===n.value.trim()&&(t.preventDefault(),alert("Vui lòng nhập từ khóa tìm kiếm"))}))}))})),"loading"in HTMLImageElement.prototype){document.querySelectorAll("img[data-src]").forEach((e=>{e.src=e.dataset.src}))}else{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js",document.body.appendChild(e)}let resizeTimer;document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('a[href*="#"]').forEach((e=>{e.addEventListener("click",(function(e){if(this.hasAttribute("data-bs-toggle"))return;const t=this.getAttribute("href");if("#"===t)return;const n=t.includes("#")?t.split("#")[1]:null;if(n){const t=document.getElementById(n);if(t){e.preventDefault();const n=t.offsetTop-120;window.scrollTo({top:n,behavior:"smooth"})}}}))}))})),function(){const e=document.getElementById("scrollToTop");if(!e)return;const t=e.querySelector("circle.progress"),n=t.r.baseVal.value,s=2*Math.PI*n;function o(){const n=window.pageYOffset||document.documentElement.scrollTop,o=document.documentElement.scrollHeight-document.documentElement.clientHeight,i=s-n/o*100/100*s;t.style.strokeDashoffset=i,n>300?e.classList.add("show"):e.classList.remove("show")}t.style.strokeDasharray=s,t.style.strokeDashoffset=s,e.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})}));let i=!1;window.addEventListener("scroll",(function(){i||(window.requestAnimationFrame((function(){o(),i=!1})),i=!0)})),o()}(),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("bannerCarousel");if(!e)return;const t=e.querySelectorAll('.banner-img[loading="lazy"]');if("IntersectionObserver"in window&&t.length>0){const e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target,s=n.closest(".carousel-item");s&&s.classList.add("loading"),n.onload=function(){n.classList.add("loaded"),s&&s.classList.remove("loading"),t.unobserve(n)},n.dataset.src?n.src=n.dataset.src:(n.classList.add("loaded"),s&&s.classList.remove("loading"))}}))}),{rootMargin:"100px"});t.forEach((t=>e.observe(t)))}else t.forEach((e=>e.classList.add("loaded")));if(e.addEventListener("slide.bs.carousel",(function(t){const n=e.querySelectorAll(".carousel-item"),s=t.to,o=n[s];if(o){const e=o.querySelector(".banner-img");e&&!e.classList.contains("loaded")&&e.classList.add("loaded")}[s-1<0?n.length-1:s-1,s+1>=n.length?0:s+1].forEach((e=>{const t=n[e];if(t){const e=t.querySelector(".banner-img");e&&!e.classList.contains("loaded")&&e.classList.add("loaded")}}))})),window.innerWidth>=768){let t=!1;e.addEventListener("mouseenter",(function(){t=!0;const n=bootstrap.Carousel.getInstance(e);n&&n.pause()})),e.addEventListener("mouseleave",(function(){if(t){t=!1;const n=bootstrap.Carousel.getInstance(e);n&&n.cycle()}}))}e.addEventListener("touchstart",(function(){const t=bootstrap.Carousel.getInstance(e);t&&t.pause()})),e.addEventListener("touchend",(function(){const t=bootstrap.Carousel.getInstance(e);t&&setTimeout((()=>t.cycle()),3e3)})),e.addEventListener("keydown",(function(t){const n=bootstrap.Carousel.getInstance(e);n&&("ArrowLeft"===t.key?(t.preventDefault(),n.prev()):"ArrowRight"===t.key&&(t.preventDefault(),n.next()))})),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(e.setAttribute("data-bs-interval","false"),e.querySelectorAll(".carousel-item").forEach((e=>{e.style.transition="none"})));e.querySelectorAll('.carousel-caption .btn[href^="#"]').forEach((e=>{e.addEventListener("click",(function(e){const t=this.getAttribute("href");if(t&&"#"!==t){const n=document.querySelector(t);n&&(e.preventDefault(),n.scrollIntoView({behavior:"smooth",block:"start"}))}}))})),setTimeout((()=>{e.querySelectorAll(".banner-img:not(.loaded)").forEach((e=>{e.classList.add("loaded");const t=e.closest(".carousel-item");t&&t.classList.remove("loading")}))}),3e3),"undefined"!=typeof gtag&&e.addEventListener("slid.bs.carousel",(function(t){const n=e.querySelector(".carousel-item.active"),s=n?.querySelector("h1, h2")?.textContent;gtag("event","banner_view",{event_category:"Banner",event_label:s||`Slide ${t.to+1}`,value:t.to+1})}));const n=e.querySelector(".banner-img");if(n){const e=n.getAttribute("src")||"";if(e.includes("cloudinary.com")||e.includes("imgix.net")){const t=document.createElement("link");t.rel="preconnect",t.href=e.includes("cloudinary")?"https://res.cloudinary.com":"https://assets.imgix.net",t.crossOrigin="anonymous",document.head.appendChild(t)}}})),window.addEventListener("resize",(function(){clearTimeout(resizeTimer),resizeTimer=setTimeout((function(){const e=document.getElementById("bannerCarousel");if(!e)return;e.querySelectorAll("picture").forEach((e=>{const t=e.querySelector("img");t&&(t.src=t.src)}))}),250)})),function(){"use strict";const e=document.getElementById("projectsCarousel"),t=document.getElementById("prevBtn"),n=document.getElementById("nextBtn"),s=document.getElementById("carouselDots");if(!e||!s)return void console.warn("Featured Projects Carousel: Required elements not found");const o=e.querySelectorAll(".project-slide"),i=o.length;if(0===i)return void console.warn("Featured Projects Carousel: No slides found");let r=0,a=null,c=!1,d=0,l=0,u=0,h=0;const m={autoSlideDelay:5e3,transitionDuration:600,dragThreshold:50};function g(t=!0){e.style.transition=t?`transform ${m.transitionDuration}ms cubic-bezier(0.4, 0, 0.2, 1)`:"none";const n=100*-r;e.style.transform=`translateX(${n}%)`;s.querySelectorAll(".dot").forEach(((e,t)=>{e.classList.toggle("active",t===r)})),o.forEach(((e,t)=>{e.setAttribute("aria-hidden",t!==r)}))}function f(){r=(r+1)%i,g()}function y(){r=(r-1+i)%i,g()}function p(){v(),a=setInterval(f,m.autoSlideDelay)}function v(){a&&(clearInterval(a),a=null)}function b(){v(),p()}function E(e){return e.type.includes("mouse")?e.pageX:e.touches[0].clientX}function L(t){t.target.closest("a, button")||(c=!0,d=E(t),h=requestAnimationFrame(T),v(),e.style.cursor="grabbing",e.classList.add("dragging"))}function w(e){if(!c)return;const t=E(e);l=u+(t-d)}function C(){if(!c)return;c=!1,cancelAnimationFrame(h),e.style.cursor="grab",e.classList.remove("dragging");const t=l-u;Math.abs(t)>m.dragThreshold?t<0?f():y():g(),u=-r*e.offsetWidth,l=u,p()}function T(){if(!c)return;const t=e.offsetWidth,n=-(i-1)*t;l>0&&(l=0+.3*(l-0)),l<n&&(l=n+.3*(l-n));const s=l/t*100;e.style.transition="none",e.style.transform=`translateX(${s}%)`,h=requestAnimationFrame(T)}function I(t){const n=e.getBoundingClientRect();n.top<window.innerHeight&&n.bottom>=0&&("ArrowLeft"===t.key?(y(),b()):"ArrowRight"===t.key&&(f(),b()))}function q(){document.hidden?v():p()}function B(){u=-r*e.offsetWidth,l=u,g(!1)}window.destroyProjectsCarousel=function(){v(),document.removeEventListener("visibilitychange",q),window.removeEventListener("resize",B),document.removeEventListener("keydown",I),console.log("Featured Projects Carousel: Destroyed")},s.innerHTML="",o.forEach(((e,t)=>{const n=document.createElement("div");n.className="dot",0===t&&n.classList.add("active"),n.setAttribute("aria-label",`Go to slide ${t+1}`),n.setAttribute("data-index",t),n.addEventListener("click",(()=>function(e){e<0||e>=i||(r=e,g(),b())}(t))),s.appendChild(n)})),console.log(`Created ${o.length} dots`),e.addEventListener("mousedown",L),e.addEventListener("mousemove",w),e.addEventListener("mouseup",C),e.addEventListener("mouseleave",(()=>{c&&C()})),e.addEventListener("touchstart",L,{passive:!0}),e.addEventListener("touchmove",w,{passive:!0}),e.addEventListener("touchend",C),e.addEventListener("contextmenu",(e=>e.preventDefault())),e.addEventListener("dragstart",(e=>e.preventDefault())),e.style.cursor="grab",e.addEventListener("mouseenter",v),e.addEventListener("mouseleave",(()=>{c||p()})),document.addEventListener("keydown",I),n&&n.addEventListener("click",(()=>{f(),b()})),t&&t.addEventListener("click",(()=>{y(),b()})),g(!1),p(),document.addEventListener("visibilitychange",q),window.addEventListener("resize",function(e,t){let n;return function(...s){const o=()=>{clearTimeout(n),e(...s)};clearTimeout(n),n=setTimeout(o,t)}}(B,250)),console.log(`Featured Projects Carousel: Initialized with ${i} slides`)}();class ChatbotWidget{constructor(){this.isOpen=!1,this.isTyping=!1,this.remainingRequests=20,this.chatButton=document.getElementById("chatbotButton"),this.chatWidget=document.getElementById("chatbotWidget"),this.closeBtn=document.getElementById("chatbotCloseBtn"),this.messagesContainer=document.getElementById("chatbotMessages"),this.userInput=document.getElementById("chatbotInput"),this.sendBtn=document.getElementById("chatbotSendBtn"),this.resetBtn=document.getElementById("chatbotResetBtn"),this.requestCountEl=document.getElementById("requestCount"),this.chatButton&&this.chatWidget?this.init():console.error("Chatbot elements not found")}init(){this.chatButton.addEventListener("click",(()=>this.toggleChat())),this.closeBtn.addEventListener("click",(()=>this.toggleChat())),this.sendBtn.addEventListener("click",(()=>this.sendMessage())),this.resetBtn.addEventListener("click",(()=>this.resetChat())),this.userInput.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())})),console.log("Chatbot initialized successfully")}toggleChat(){this.isOpen=!this.isOpen,this.chatWidget.classList.toggle("active"),this.isOpen?(document.body.classList.add("chatbot-open"),this.scrollToBottom(),this.isMobile()&&(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top="0")):(document.body.classList.remove("chatbot-open"),this.isMobile()&&(document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top=""))}isMobile(){return window.innerWidth<=768}async sendMessage(){const e=this.userInput.value.trim();if(e&&!this.isTyping)if(e.length>500)alert("Tin nhắn quá dài! Vui lòng nhập tối đa 500 ký tự.");else{this.addMessage(e,"user"),this.userInput.value="",this.setInputState(!1),this.showTyping();try{const t=await fetch("/chatbot/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})}),n=await t.json();this.hideTyping(),t.ok?(this.addMessage(n.response,"bot"),void 0!==n.remaining_requests&&(this.remainingRequests=n.remaining_requests,this.updateRequestCount())):this.addMessage(n.error||n.response||"Xin lỗi, đã có lỗi xảy ra. Vui lòng thử lại! 😊","bot")}catch(e){console.error("Chatbot error:",e),this.hideTyping(),this.addMessage("Xin lỗi, không thể kết nối đến server. Vui lòng kiểm tra kết nối mạng! 🔌","bot")}finally{this.setInputState(!0)}}}addMessage(e,t){const n=document.createElement("div");n.className=`chatbot-message ${t}`;const s=document.createElement("div");s.className="chatbot-message-content",s.innerHTML=this.escapeHtml(e).replace(/\n/g,"<br>"),n.appendChild(s),this.messagesContainer.appendChild(n),this.scrollToBottom()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}showTyping(){this.isTyping=!0;const e=document.createElement("div");e.className="chatbot-message bot",e.id="chatbotTypingIndicator";const t=document.createElement("div");t.className="chatbot-typing",t.innerHTML="<span></span><span></span><span></span>",e.appendChild(t),this.messagesContainer.appendChild(e),this.scrollToBottom()}hideTyping(){this.isTyping=!1;const e=document.getElementById("chatbotTypingIndicator");e&&e.remove()}setInputState(e){this.userInput.disabled=!e,this.sendBtn.disabled=!e,this.sendBtn.style.opacity=e?"1":"0.5"}scrollToBottom(){setTimeout((()=>{this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}),100)}async resetChat(){if(confirm("Bạn có chắc muốn làm mới hội thoại? Tất cả tin nhắn sẽ bị xóa."))try{if((await fetch("/chatbot/reset",{method:"POST",headers:{"Content-Type":"application/json"}})).ok){this.messagesContainer.querySelectorAll(".chatbot-message").forEach(((e,t)=>{t>0&&e.remove()})),this.remainingRequests=20,this.updateRequestCount(),this.addMessage("Đã làm mới hội thoại! Tôi có thể giúp gì cho bạn? 😊","bot")}}catch(e){console.error("Reset error:",e),alert("Không thể làm mới hội thoại. Vui lòng thử lại!")}}updateRequestCount(){this.requestCountEl&&(this.requestCountEl.textContent=`Còn ${this.remainingRequests} tin nhắn`)}}document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("chatbotButton")&&new ChatbotWidget}));